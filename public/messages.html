<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1"/>
<meta content="LCIlFlxOaCYfPDdRGiMAPywgZDMdEwEYnaGn4c_m-Tec_BdGzkTB0jNi" name="csrf-token">
<title>Carbonoz Solarpilot</title>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Exo:wght@400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Exo:wght@400;500;600&display=swap" rel="stylesheet" type="text/css"/>
    </noscript>
    <link phx-track-static rel="stylesheet" href="./css/style.css"/>
    <link rel="stylesheet" href="./css/message.css">
    <link rel="manifest" href="/manifest.json">

    <script defer phx-track-static type="text/javascript" src="/js/app-ed5fb725b2323e6c326d78d689c148ae.js?vsn=d"></script>
    <script defer phx-track-static type="text/javascript" src="/js/vendor/echarts.min-c5ef426b883db4257694b21b88257a57.js?vsn=d"></script>
</head>
<body class="with-header">
<div class="header">
    <div class="container">
        <div class="logo"><h1> <span style="color: red;">Carbonoz</span> Solarpilot</h1></div>
        <div class="menu">
<a href="/" class="menu-item" data-phx-link="redirect" data-phx-link-state="push">
            <div class="item-img" style="background-image: url(/images/tabs/dashboard-fe6236ddd7c826e9f469babe7dee6705.svg?vsn=d);"></div>
            <span class="item-caption">Dashboard</span>
</a>
            <a href="#charts" data-iframe="/grafana/d/sa-charts?kiosk=tv" class="menu-item">
                <div class="item-img" style="background-image: url(/images/tabs/chart-34fb756a097dde6fe750a40b934affdc.svg?vsn=d);"></div>
                <span class="item-caption">Charts</span>
            </a>
<a href="/analytics" class="menu-item" data-phx-link="redirect" data-phx-link-state="push">
            <div class="item-img" style="background-image: url(/images/tabs/totals-e8345009cbaf91c5842f3bb7500afb79.svg?vsn=d);"></div>
            <span class="item-caption">Analytics</span>
</a>
<a href="/messages" class="menu-item" data-phx-link="redirect" data-phx-link-state="push">
            <div class="item-img" style="background-image: url(/images/tabs/power-60ba709da78825327d4c97c37e46da40.svg?vsn=d);"></div>
            <span class="item-caption">Messages</span>
</a>
<a href="/settings" class="menu-item" data-phx-link="redirect" data-phx-link-state="push">
            <div class="item-img" style="background-image: url(/images/tabs/config-2b0dc6769e27cd4f705e08033cdec960.svg?vsn=d);"></div>
            <span class="item-caption">Settings</span>
</a>
        </div>
    </div>
</div>

    <section>
        <h2>Filter Messages</h2>
        <label for="categoryFilter">Select Category:</label>
        <select id="categoryFilter" name="categoryFilter">
            <option value="all">All</option>
            <option value="inverter1">Inverter 1</option>
            <option value="inverter2">Inverter 2</option>
            <option value="loadPower">Load Power</option>
            <option value="gridPower">Grid Power</option>
            <!-- Add more categories as needed -->
        </select>

        <h2>Incoming Messages</h2>
        <ul id="messageList">
            <!-- Messages will be dynamically added here using JavaScript -->
        </ul>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Fetch and display initial messages
            fetchMessages();

            // Update messages when the category filter changes
            document.getElementById('categoryFilter').addEventListener('change', fetchMessages);
        });

        function fetchMessages() {
            const categoryFilter = document.getElementById('categoryFilter').value;

            // Fetch messages from the server based on the selected category
            fetch(`/api/messages?category=${categoryFilter}`)
                .then(response => response.json())
                .then(data => {
                    // Update the message list
                    updateMessageList(data);
                })
                .catch(error => {
                    console.error('Error fetching messages:', error.message);
                });
        }

        function updateMessageList(messages) {
            const messageListElement = document.getElementById('messageList');
            messageListElement.innerHTML = '';

            if (messages.length === 0) {
                const listItem = document.createElement('li');
                listItem.textContent = 'No messages available.';
                messageListElement.appendChild(listItem);
            } else {
                messages.forEach(message => {
                    const listItem = document.createElement('li');
                    const progress = document.createElement('progress');
                    progress.value = extractVoltage(message);
                    progress.max = 100;
                    listItem.appendChild(progress);
                    listItem.appendChild(document.createTextNode(message));
                    messageListElement.appendChild(listItem);
                });
            }
        }

        function extractVoltage(message) {
            // Extract voltage from the message (example: solar_assistant_DEYE/inverter_2/ac_output_frequency/state: 50.18)
            const match = message.match(/state: (\d+(\.\d+)?)/);
            return match ? parseFloat(match[1]) : 0;
        }
    </script>
</body>
</html>
